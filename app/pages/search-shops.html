@@include("blocks/head/head.html", {"title": "Найти магазины"})
<div class="wrapper">
	@@include("blocks/header/header.html")
	@@include("blocks/burger/burger.html")
	<main class="page search-shops">
		<div class="container">
			<nav class="breadcrumbs" aria-label="breadcrumbs">
				<ol class="breadcrumbs__list">
					<li class="breadcrumbs__item">
						<a href="#">
							Главная
						</a>
					</li>
					<li class="breadcrumbs__item">
						<span>Найти магазины</span>
					</li>
				</ol>
			</nav>

			<h1 class="title page__title">Найти магазины</h1>

			<div class="search-shops__select select">
				<div class="select__title">Санкт-Петербург</div>
				<div class="select__content">
					<label class="select__option" tabindex="0" data-city="peterburg">
						<input class="select__input" type="radio" name="shops-city" checked />
						<span class="radio-style"></span>
						<span class="select__option-text">Санкт-Петербург</span>
					</label>
					<label class="select__option" tabindex="0" data-city="moscow">
						<input class="select__input" type="radio" name="shops-city" />
						<span class="radio-style"></span>
						<span class="select__option-text">Москва</span>
					</label>
				</div>
			</div>

			<div id="shops-map" class="search-shops__map"></div>

			<div class="search-shops__grid">
				<div data-id="1" data-city="peterburg" class="search-shops__item shop-item">
					<div class="shop-item__top">
						<svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M16 0C9.33809 0 3.9375 5.40056 3.9375 12.0625C3.9375 14.2904 4.37358 16.5915 5.62499 18.25L16 32L26.375 18.25C27.5117 16.7436 28.0625 14.0805 28.0625 12.0625C28.0625 5.40056 22.6619 0 16 0Z"
								fill="#101112" />
							<ellipse cx="16.0002" cy="12.3078" rx="4.92308" ry="4.92308" fill="white" />
						</svg>
						<div class="shop-item__title">Санкт-Петербург</div>
					</div>
					<div class="shop-item__address">
						<p>Лиговский пр-т , д.30 корпус 5</p>
						<p>Пн-вс: 10:00-22:00</p>
					</div>
					<a href="tel:+70000000000" class="shop-item__phone">
						<svg viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M8.8963 9.39752L9.8763 8.41752C10.0083 8.28716 10.1753 8.19793 10.357 8.16065C10.5387 8.12337 10.7274 8.13965 10.9 8.20752L12.0944 8.68439C12.2689 8.75521 12.4185 8.8761 12.5244 9.03181C12.6303 9.18753 12.6877 9.3711 12.6894 9.55939V11.7469C12.6884 11.875 12.6615 12.0015 12.6103 12.119C12.559 12.2364 12.4846 12.3422 12.3914 12.4301C12.2982 12.518 12.1882 12.5861 12.068 12.6303C11.9478 12.6746 11.8198 12.694 11.6919 12.6875C3.32255 12.1669 1.6338 5.07939 1.31442 2.36689C1.29959 2.23369 1.31314 2.09886 1.35417 1.97127C1.39519 1.84367 1.46277 1.72621 1.55245 1.62661C1.64213 1.52702 1.75188 1.44753 1.87449 1.3934C1.99709 1.33926 2.12977 1.3117 2.2638 1.31252H4.37692C4.56549 1.31308 4.74957 1.37003 4.90551 1.47607C5.06144 1.5821 5.18208 1.73236 5.25192 1.90752L5.7288 3.10189C5.79891 3.27386 5.81679 3.46267 5.78022 3.64475C5.74365 3.82682 5.65425 3.99408 5.52317 4.12564L4.54317 5.10564C4.54317 5.10564 5.10755 8.92502 8.8963 9.39752Z"
								fill="#101112" />
						</svg>
						+7 000 000 00 00
					</a>
				</div>
				<div data-id="2" data-city="moscow" class="search-shops__item shop-item">
					<div class="shop-item__top">
						<svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M16 0C9.33809 0 3.9375 5.40056 3.9375 12.0625C3.9375 14.2904 4.37358 16.5915 5.62499 18.25L16 32L26.375 18.25C27.5117 16.7436 28.0625 14.0805 28.0625 12.0625C28.0625 5.40056 22.6619 0 16 0Z"
								fill="#101112" />
							<ellipse cx="16.0002" cy="12.3078" rx="4.92308" ry="4.92308" fill="white" />
						</svg>
						<div class="shop-item__title">Москва</div>
					</div>
					<div class="shop-item__address">
						<p>Лиговский пр-т , д.30 корпус 5</p>
						<p>Пн-вс: 10:00-22:00</p>
					</div>
					<a href="tel:+70000000000" class="shop-item__phone">
						<svg viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M8.8963 9.39752L9.8763 8.41752C10.0083 8.28716 10.1753 8.19793 10.357 8.16065C10.5387 8.12337 10.7274 8.13965 10.9 8.20752L12.0944 8.68439C12.2689 8.75521 12.4185 8.8761 12.5244 9.03181C12.6303 9.18753 12.6877 9.3711 12.6894 9.55939V11.7469C12.6884 11.875 12.6615 12.0015 12.6103 12.119C12.559 12.2364 12.4846 12.3422 12.3914 12.4301C12.2982 12.518 12.1882 12.5861 12.068 12.6303C11.9478 12.6746 11.8198 12.694 11.6919 12.6875C3.32255 12.1669 1.6338 5.07939 1.31442 2.36689C1.29959 2.23369 1.31314 2.09886 1.35417 1.97127C1.39519 1.84367 1.46277 1.72621 1.55245 1.62661C1.64213 1.52702 1.75188 1.44753 1.87449 1.3934C1.99709 1.33926 2.12977 1.3117 2.2638 1.31252H4.37692C4.56549 1.31308 4.74957 1.37003 4.90551 1.47607C5.06144 1.5821 5.18208 1.73236 5.25192 1.90752L5.7288 3.10189C5.79891 3.27386 5.81679 3.46267 5.78022 3.64475C5.74365 3.82682 5.65425 3.99408 5.52317 4.12564L4.54317 5.10564C4.54317 5.10564 5.10755 8.92502 8.8963 9.39752Z"
								fill="#101112" />
						</svg>
						+7 000 000 00 00
					</a>
				</div>
			</div>
		</div>
	</main>
	@@include("blocks/footer/footer.html")
	@@include("blocks/pageup/pageup.html")
	<div class="overlay">
		@@include("blocks/auth/auth.html")
		@@include("blocks/popup/password-recovery.html")
		@@include("blocks/drop-basket/drop-basket.html")
	</div>
	@@include("blocks/popup/discount-popup.html")
	@@include("blocks/region-popup/region-popup.html")
</div>
<script src="https://api-maps.yandex.ru/2.1.79/?lang=ru_RU"></script>
@@include("blocks/link/link.html")

<style>
	/* Фиксированная версия 2.1.79 позволяет привязаться к этим классам */
	.ymaps-2-1-79-balloon__close,
	.ymaps-2-1-79-balloon__tail {
		display: none;
	}

	.ymaps-2-1-79-balloon__close+.ymaps-2-1-79-balloon__content {
		margin-right: 0;
	}

	.ymaps-2-1-79-balloon__content {
		padding: 0;
		margin-right: 0;
	}

	.ymaps-2-1-79-balloon__content img {
		width: 100%;
		height: 16rem;
		object-fit: cover;
	}

	.ymaps-2-1-79-balloon-content__header {
		margin-bottom: 0;
	}

	.ymaps-2-1-79-balloon__content>* {
		width: 28.6rem !important;
		height: auto !important;
		overflow: hidden !important;
	}

	@media(max-width: 500px) {
		.ymaps-2-1-79-balloon__content>* {
			width: 100% !important;
		}
	}

</style>

<script>
	$('.search-shops__item').addClass('hidden');
	$(`.search-shops__item[data-city="${$('.search-shops__select .select__option input:checked').parent().attr('data-city')}"`)
		.removeClass('hidden');

	function filterCities() {
		$('.search-shops__select .select__option').on('click', function () {
			$('.search-shops__item').addClass('hidden');
			$(`.search-shops__item[data-city="${$(this).attr('data-city')}"`).removeClass('hidden');
		});
	}
	filterCities();

	ymaps.ready(init);

	function init() {
		var myMap = new ymaps.Map('shops-map', {
				center: [55.76, 37.64],
				zoom: 11,
				controls: []
			}, {
				searchControlProvider: 'yandex#search'
			}),
			objectManager = new ymaps.ObjectManager({
				clusterize: true,
				gridSize: 64,
				clusterize: true
			});
		myMap.geoObjects.add(objectManager);

		function filterCity(cityName) {
			let filterStr = 'options.city == "' + cityName + '"';
			objectManager.setFilter(filterStr);
		}

		$('body').on('change', '.search-shops__select .select__option input', function () {
			filterCity($('.search-shops__select .select__input:checked').parent().attr('data-city'));
		});

		$('body').on('click', '.shop-item__top', function () {
			objectManager.objects.balloon.open($(this).parent().attr('data-id'));
		});

		$.ajax({
			url: "data.json",
			cash: false,
		}).done(function (data) {
			objectManager.add(data);
			filterCity($('.search-shops__select .select__input:checked').parent().attr('data-city'));
			var objectState = objectManager.getObjectState(1);
			if (objectState.isClustered) {
				objectManager.clusters.state.set('activeObject', objectManager.objects.getById(1));
				objectManager.clusters.balloon.open(objectState.cluster.id);
			}
		});
	}

</script>
